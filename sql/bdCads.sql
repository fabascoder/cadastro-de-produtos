CREATE DATABASE bdCads;
USE bdCads;


/*TABELA DE CADASTRO*/

CREATE TABLE tbCadastro (
    ID INT PRIMARY KEY AUTO_INCREMENT,
    NOME VARCHAR(100) NOT NULL,
    EMAIL VARCHAR(100) NOT NULL UNIQUE,
    SENHA VARCHAR(100) NOT NULL,
    DATA_CADASTRO TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

/*TABELA DE USUÁRIOS*/

CREATE TABLE tbUsuario (
    ID INT PRIMARY KEY AUTO_INCREMENT,
    NOME VARCHAR(100) NOT NULL,
    EMAIL VARCHAR(100) NOT NULL UNIQUE,
    SENHA VARCHAR(100) NOT NULL,
    DATA_CADASTRO TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    ID_CADASTRO INT,
    FOREIGN KEY (ID_CADASTRO) REFERENCES tbCadastro(ID)
);

/*TABELA DE ADMINISTRADORES*/

CREATE TABLE tbAdminVendedor (
    ID INT PRIMARY KEY AUTO_INCREMENT,
    NOME VARCHAR(100) NOT NULL,
    NOME_LOJA VARCHAR(100),
    CPF VARCHAR(14) NOT NULL UNIQUE,
    EMAIL VARCHAR(100) NOT NULL UNIQUE,
    SENHA VARCHAR(100) NOT NULL,
    DATA_CADASTRO TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    ID_CADASTRO INT,
    FOREIGN KEY (ID_CADASTRO) REFERENCES tbCadastro(ID),
    STATUS VARCHAR(20) DEFAULT
);

/*TABELA DE CADASTRO DE PRODUTOS*/

CREATE TABLE tbCadastroProduto (
    ID INT PRIMARY KEY AUTO_INCREMENT,
    NOME VARCHAR(100) NOT NULL,
    VALOR DECIMAL(10, 2) NOT NULL,
    DESCONTO DECIMAL(5, 3) DEFAULT 0.000,
    QUANT INT,
    DESCRICAO VARCHAR(255) NOT NULL,
    DATA_CADASTRO TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    ID_PRODUTO INT,
    FOREIGN KEY (ID_PRODUTO) REFERENCES tbProduto(ID)
);

/*TABELA DE PRODUTOS*/

CREATE TABLE tbProduto (
    ID INT PRIMARY KEY IDENTITY(1,1),
    NOME VARCHAR(100) NOT NULL,
    VALOR DECIMAL(10, 2) NOT NULL,
    DESCRICAO VARCHAR(255) NOT NULL,
    DATA_CADASTRO TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

/*TABELA DE LOJAS*/

CREATE TABLE tbLoja (
    ID INT PRIMARY KEY AUTO_INCREMENT,
    NOME_LOJA VARCHAR(100) NOT NULL,
    CNPJ VARCHAR(18) NOT NULL UNIQUE,
    SENHA VARCHAR(100) NOT NULL,
    DATA_CADASTRO TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

/*TABELA DE CARRINHO DE COMPRAS*/

CREATE TABLE tbCarrinho (
    ID INT PRIMARY KEY AUTO_INCREMENT,
    ID_USUARIO INT,
    ID_PRODUTO INT,
    QUANTIDADE INT DEFAULT 1,
    DATA_ADICIONADO TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (ID_USUARIO) REFERENCES tbUsuario(ID),
    FOREIGN KEY (ID_PRODUTO) REFERENCES tbProduto(ID)
);

/*TABELA DE PEDIDOS*/

CREATE TABLE tbPedido (
    ID INT PRIMARY KEY AUTO_INCREMENT,
    ID_USUARIO INT,
    DATA_PEDIDO TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    VALOR_TOTAL DECIMAL(10, 2) NOT NULL,
    STATUS VARCHAR(50) DEFAULT 'Pendente',
    FOREIGN KEY (ID_USUARIO) REFERENCES tbUsuario(ID)
);

/*TABELA DE PAGAMENTOS*/

CREATE TABLE tbPagamento (
    ID INT PRIMARY KEY AUTO_INCREMENT,
    ID_PEDIDO INT,
    TIPO_PAGAMENTO VARCHAR(50) NOT NULL,
    STATUS_PAGAMENTO VARCHAR(50) DEFAULT 'Pendente',
    DATA_PAGAMENTO TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (ID_PEDIDO) REFERENCES tbPedido(ID)
);

/* INSERINDO DADOS NA TABELA DE PRODUTOS */

    INSERT INTO tbProduto (NOME, VALOR, DESCRICAO)
    VALUES 
    ('Celular', 1500.00, 'Smartphone de última geração com câmera de alta resolução e bateria de longa duração.');

/*PEGANDO O ID DO PRODUTO INSERIDO*/

    SET @idProduto := LAST_INSERT_ID();

/* INSERINDO DADOS NA TABELA DE CADASTRO */

    INSERT INTO tbCadastro (NOME, EMAIL, SENHA)
    VALUES 
    ('Maria Souza', 'maria@gmail.com', SHA2('senha123', 256));

/* PEGANDO O ID DO CADASTRO INSERIDO*/

    SET @idCadastro := LAST_INSERT_ID();

/* INSERINDO DADOS NA TABELA DE USUÁRIOS */

    INSERT INTO tbUsuario (NOME, EMAIL, SENHA, ID_CADASTRO)
    VALUES 
    ('João da Silva', 'joao@gmail.com', SHA2('senha123', 256), @idCadastro);

/* INSERINDO DADOS NA TABELA DE ADMINISTRADORES */

    INSERT INTO tbAdminVendedor (NOME, EMAIL, SENHA, ID_CADASTRO)
    VALUES 
    ('João Pereira', 'joaoPereira@gmail.com', SHA2('senha1234', 256), @idCadastro);

/* INSERINDO DADOS NA TABELA DE CADASTRO DE PRODUTOS */

    INSERT INTO tbCadastroProduto (NOME, VALOR, DESCONTO, QUANT, DESCRICAO, ID_PRODUTO)
    VALUES 
    ('Celular', 1500.00, 0.10, 5, 'Smartphone de última geração com câmera de alta resolução e bateria de longa duração.', @idProduto);